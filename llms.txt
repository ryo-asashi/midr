# midr

The goal of ‘midr’ is to provide a model-agnostic method for
interpreting and explaining black-box predictive models by creating a
globally interpretable surrogate model. The package implements ‘Maximum
Interpretation Decomposition’ (MID), a functional decomposition
technique that finds an optimal additive approximation of the original
model. This approximation is achieved by minimizing the squared error
between the predictions of the black-box model and the surrogate model.
The theoretical foundations of MID are described in Iwasawa & Matsumori
(2026) \[Forthcoming\], and the package itself is detailed in [Asashiba
et al. (2025)](https://arxiv.org/abs/2506.08338).

## Installation

You can install the released version of midr from
[CRAN](https://cran.r-project.org/) with:

``` r
install.packages("midr")
```

and the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ryo-asashi/midr")
```

## Examples

In the following example, we fit a random forest model to the `Boston`
dataset included in ISLR2, and then attempt to interpret it using the
functions of midr.

``` r
# load required packages
library(midr)
library(ggplot2)
library(gridExtra)
library(ISLR2)
library(ranger)
theme_set(theme_midr("xy"))
# split the Boston dataset
data("Boston", package = "ISLR2")
set.seed(42)
idx <- sample(nrow(Boston), nrow(Boston) * .75)
train <- Boston[ idx, ]
valid <- Boston[-idx, ]
# fit a random forest model
rf <- ranger(medv ~ ., train, mtry = 5)
preds_rf <- predict(rf, valid)$predictions
cat("RMSE: ", weighted.loss(valid$medv, preds_rf))
#> RMSE:  3.351362
```

The first step is to create a MID model as a global surrogate of the
target model using
[`interpret()`](https://ryo-asashi.github.io/midr/reference/interpret.md).

``` r
# fit a two-dimensional MID model
mid <- interpret(medv ~ .^2, train, rf, lambda = .1)
mid
#> 
#> Call:
#> interpret(formula = medv ~ .^2, data = train, model = rf, lambda = 0.1)
#> 
#> Model Class: ranger
#> 
#> Intercept: 22.446
#> 
#> Main Effects:
#> 12 main effect terms
#> 
#> Interactions:
#> 66 interaction terms
#> 
#> Uninterpreted Variation Ratio: 0.016248
preds_mid <- predict(mid, valid)
cat("RMSE: ", weighted.loss(preds_rf, preds_mid))
#> RMSE:  1.106667
cat("RMSE: ", weighted.loss(valid$medv, preds_mid))
#> RMSE:  3.306324
```

To visualize the main and interaction effects of the variables, apply
[`ggmid()`](https://ryo-asashi.github.io/midr/reference/ggmid.md) or
[`plot()`](https://rdrr.io/r/graphics/plot.default.html) to the fitted
MID model.

``` r
# visualize the main and interaction effects of the MID model
grid.arrange(
  ggmid(mid, "lstat") +
    labs(title = "Feature Effects",
         subtitle = "Main Effect of 'lstat'"),
  ggmid(mid, "dis") +
    labs(title = "", subtitle = "Main effect of 'dis'"),
  ggmid(mid, "lstat:dis") +
    labs(subtitle = "Interaction Effect of 'lstat:dis'"),
  ggmid(mid, "lstat:dis", main.effects = TRUE, type = "compound") +
    labs(subtitle = "Total Effect of 'lstat:dis'")
)
```

![](reference/figures/README-ggmid-1.png)

``` r
# visualize all main effects
grid.arrange(grobs = mid.plots(mid), nrow = 3)
```

![](reference/figures/README-ggmid-2.png)

[`mid.importance()`](https://ryo-asashi.github.io/midr/reference/mid.importance.md)
helps to compute and compare the importance of main and interaction
effects.

``` r
# visualize the MID importance of the component functions
imp <- mid.importance(mid)
grid.arrange(nrow = 1L,
  ggmid(imp, fill = "steelblue", max.nterms = 20) +
    theme(legend.position = "none") +
    labs(title = "Feature Effect Importance",
         subtitle = "Bar Plot"),
  ggmid(imp, "heatmap", linewidth=.25, color="gray85") +
    theme(legend.position = "none") +
    labs(title = "", subtitle = "Heat Map")
)
```

![](reference/figures/README-mid_importance-1.png)

[`mid.breakdown()`](https://ryo-asashi.github.io/midr/reference/mid.breakdown.md)
provides a way to analyze individual predictions by decomposing the
differences between the intercept and the predicted value into variable
effects.

``` r
# visualize the MID breakdown of the model predictions
bd1 <- mid.breakdown(mid, data = train, row = 1L)
bd9 <- mid.breakdown(mid, data = train, row = 9L)
grid.arrange(nrow = 1L,
  ggmid(bd1, fill = "steelblue") +
    theme(legend.position = "none") +
    labs(title = "Additive Breakdown of Predictions",
         subtitle = "Waterfall Plot for Row 1"),
  ggmid(bd9, theme = "shap", size = 3, type = "dotchart") +
    theme(legend.position = "none") +
    labs(title = "", subtitle = "Dot Chart for Row 9")
)
```

![](reference/figures/README-mid_breakdown-1.png)

[`mid.conditional()`](https://ryo-asashi.github.io/midr/reference/mid.conditional.md)
can be used to compute the ICE curves (Goldstein et al. 2015) of the
fitted MID model, as well as the breakdown of the ICE curves by main and
interaction effects.

``` r
# visualize the ICE curves of the MID model
ice <- mid.conditional(mid, "lstat", max.nsamples = 200)
grid.arrange(
  ggmid(ice, color = "steelblue") +
    labs(title = "Individual Conditional Expectation",
         subtitle = "ICE Plot of 'lstat'"),
  ggmid(ice, "centered", color = "steelblue") +
    labs(title = "", subtitle = "c-ICE Plot of 'lstat'"),
  ggmid(ice, term = "lstat:dis", var.color = dis) +
    labs(subtitle = "Interaction Effect with 'dis'"),
  ggmid(ice, term = "lstat:age", var.color = age) +
    labs(subtitle = "Interaction Effect with 'age'")
)
```

![](reference/figures/README-mid_conditional-1.png)

## References

\[1\] Iwasawa, H. & Matsumori, Y. (2026). “A Functional Decomposition
Approach to Maximize the Interpretability of Black-Box Models”.
\[Forthcoming\]

\[2\] Asashiba, R., Kozuma, R. & Iwasawa, H. (2025). “midr: Learning
from Black-Box Models by Maximum Interpretation Decomposition”.
<https://arxiv.org/abs/2506.08338>

\[3\] Goldstein, A., Kapelner, A., Bleich, J., & Pitkin, E. (2015).
“Peeking Inside the Black Box: Visualizing Statistical Learning With
Plots of Individual Conditional Expectation”. *Journal of Computational
and Graphical Statistics*, *24*(1), 44–65.
<https://doi.org/10.1080/10618600.2014.907095>

# Package index

## Fit MID models

- [`interpret()`](https://ryo-asashi.github.io/midr/reference/interpret.md)
  : Fit MID Models

### Methods

- [`plot(`*`<mid>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.mid.md)
  : Plot MID Component Functions
- [`ggmid()`](https://ryo-asashi.github.io/midr/reference/ggmid.md)
  [`autoplot(`*`<mid>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.md)
  : Plot MID Component Functions with ggplot2
- [`mid.plots()`](https://ryo-asashi.github.io/midr/reference/mid.plots.md)
  : Plot Multiple MID Component Functions
- [`predict(`*`<mid>`*`)`](https://ryo-asashi.github.io/midr/reference/predict.mid.md)
  [`predict(`*`<mids>`*`)`](https://ryo-asashi.github.io/midr/reference/predict.mid.md)
  : Predict Method for fitted MID Models
- [`mid.effect()`](https://ryo-asashi.github.io/midr/reference/mid.effect.md)
  [`mid.f()`](https://ryo-asashi.github.io/midr/reference/mid.effect.md)
  : Evaluate Single MID Component Functions
- [`print(`*`<mid>`*`)`](https://ryo-asashi.github.io/midr/reference/print.mid.md)
  [`print(`*`<mids>`*`)`](https://ryo-asashi.github.io/midr/reference/print.mid.md)
  : Print MID Models
- [`summary(`*`<mid>`*`)`](https://ryo-asashi.github.io/midr/reference/summary.mid.md)
  [`summary(`*`<mids>`*`)`](https://ryo-asashi.github.io/midr/reference/summary.mid.md)
  : Summarize MID Models
- [`mid.terms()`](https://ryo-asashi.github.io/midr/reference/mid.terms.md)
  : Extract Terms from MID Models

## Combine MID models

- [`midlist()`](https://ryo-asashi.github.io/midr/reference/midlist.md)
  : Combine MID Objects

### Methods

- [`labels(`*`<midlist>`*`)`](https://ryo-asashi.github.io/midr/reference/labels.midlist.md)
  [`labels(`*`<midrib>`*`)`](https://ryo-asashi.github.io/midr/reference/labels.midlist.md)
  [`` `labels<-`() ``](https://ryo-asashi.github.io/midr/reference/labels.midlist.md)
  : Label MID Objects
- [`` `[`( ``*`<midlist>`*`)`](https://ryo-asashi.github.io/midr/reference/extract.midlist.md)
  [`` `[`( ``*`<midrib>`*`)`](https://ryo-asashi.github.io/midr/reference/extract.midlist.md)
  [`` `[[`( ``*`<midrib>`*`)`](https://ryo-asashi.github.io/midr/reference/extract.midlist.md)
  : Subset MID Objects
- [`plot(`*`<mids>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.mids.md)
  : Compare MID Component Functions
- [`ggmid(`*`<mids>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.mids.md)
  [`autoplot(`*`<mids>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.mids.md)
  : Compare MID Component Functions with ggplot2

## Importance of effects

- [`mid.importance()`](https://ryo-asashi.github.io/midr/reference/mid.importance.md)
  : Calculate MID Importance

### Methods

- [`plot(`*`<midimp>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.midimp.md)
  : Plot MID Importance
- [`ggmid(`*`<midimp>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midimp.md)
  [`autoplot(`*`<midimp>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midimp.md)
  : Plot MID Importance with ggplot2
- [`plot(`*`<midimps>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.midimps.md)
  : Compare MID Importance
- [`ggmid(`*`<midimps>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midimps.md)
  [`autoplot(`*`<midimps>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midimps.md)
  : Compare MID Importance with ggplot2

## Breakdown of predictions

- [`mid.breakdown()`](https://ryo-asashi.github.io/midr/reference/mid.breakdown.md)
  : Calculate MID Breakdowns

### Methods

- [`plot(`*`<midbrk>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.midbrk.md)
  : Plot MID Breakdowns
- [`ggmid(`*`<midbrk>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midbrk.md)
  [`autoplot(`*`<midbrk>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midbrk.md)
  : Plot MID Breakdowns with ggplot2
- [`plot(`*`<midbrks>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.midbrks.md)
  : Compare MID Breakdown
- [`ggmid(`*`<midbrks>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midbrks.md)
  [`autoplot(`*`<midbrks>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midbrks.md)
  : Compare MID Breakdowns with ggplot2

## Conditional expectations

- [`mid.conditional()`](https://ryo-asashi.github.io/midr/reference/mid.conditional.md)
  : Calculate MID Conditional Expectations

### Methods

- [`plot(`*`<midcon>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.midcon.md)
  : Plot MID Conditional Expectations
- [`ggmid(`*`<midcon>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midcon.md)
  [`autoplot(`*`<midcon>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midcon.md)
  : Plot MID Conditional Expectations with ggplot2
- [`plot(`*`<midcons>`*`)`](https://ryo-asashi.github.io/midr/reference/plot.midcons.md)
  : Compare MID Conditional Expectations
- [`ggmid(`*`<midcons>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midcons.md)
  [`autoplot(`*`<midcons>`*`)`](https://ryo-asashi.github.io/midr/reference/ggmid.midcons.md)
  : Compare MID Conditional Expectations with ggplot2

## Other functions

- [`get.yhat()`](https://ryo-asashi.github.io/midr/reference/get.yhat.md)
  : Wrapper Prediction Function
- [`get.link()`](https://ryo-asashi.github.io/midr/reference/get.link.md)
  : Extended Parametric Link Functions

### Variable encoders

- [`factor.encoder()`](https://ryo-asashi.github.io/midr/reference/factor.encoder.md)
  [`factor.frame()`](https://ryo-asashi.github.io/midr/reference/factor.encoder.md)
  : Encoder for Qualitative Variables
- [`numeric.encoder()`](https://ryo-asashi.github.io/midr/reference/numeric.encoder.md)
  [`numeric.frame()`](https://ryo-asashi.github.io/midr/reference/numeric.encoder.md)
  : Encoder for Quantitative Variables

### Color themes

- [`color.theme()`](https://ryo-asashi.github.io/midr/reference/color.theme.md)
  : Color Themes for Graphics
- [`color.theme.info()`](https://ryo-asashi.github.io/midr/reference/color.theme.info.md)
  [`color.theme.env()`](https://ryo-asashi.github.io/midr/reference/color.theme.info.md)
  : Retrieve Color Theme Information
- [`set.color.theme()`](https://ryo-asashi.github.io/midr/reference/set.color.theme.md)
  : Register Color Themes
- [`scale_color_theme()`](https://ryo-asashi.github.io/midr/reference/scale_color_theme.md)
  [`scale_colour_theme()`](https://ryo-asashi.github.io/midr/reference/scale_color_theme.md)
  [`scale_fill_theme()`](https://ryo-asashi.github.io/midr/reference/scale_color_theme.md)
  : Color Theme Scales for ggplot2 Graphics

### Miscellaneous

- [`theme_midr()`](https://ryo-asashi.github.io/midr/reference/theme_midr.md)
  [`par.midr()`](https://ryo-asashi.github.io/midr/reference/theme_midr.md)
  : Default Plotting Themes
- [`weighted.loss()`](https://ryo-asashi.github.io/midr/reference/weighted.loss.md)
  : Weighted Loss Function
- [`shapviz(`*`<mid>`*`)`](https://ryo-asashi.github.io/midr/reference/shapviz.mid.md)
  : Calculate MID-Derived Shapley Values

# Articles

### Interpret black-box models with midr

- [Interpretation of Regression
  Models](https://ryo-asashi.github.io/midr/articles/regression.md):

  Demonstrates how to use the midr package to interpret regression
  models.

- [Interpretation of Classification
  Models](https://ryo-asashi.github.io/midr/articles/classification.md):

  Demonstrates how to use the midr package to interpret classification
  models.

### How to visualize MID models

- [Getting Started with Color
  Themes](https://ryo-asashi.github.io/midr/articles/colortheme.md):

  Provides a gallery of color themes implemented in the midr package.
